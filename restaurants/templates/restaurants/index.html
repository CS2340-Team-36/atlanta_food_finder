<!-- templates/restaurants/index.html -->

<!DOCTYPE html>
<html>
<head>
    <title>Restaurant Search</title>
    <!-- Add this in the <head> section -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap"></script>

    <script type="text/javascript">
        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 33.7490, lng: -84.3880 }, // Default center (Atlanta)
                zoom: 12
            });

            var restaurants = {{ restaurants|safe }};

            restaurants.forEach(function(restaurant) {
                var marker = new google.maps.Marker({
                    position: { lat: restaurant.latitude, lng: restaurant.longitude },
                    map: map,
                    title: restaurant.name
                });

                var infoWindow = new google.maps.InfoWindow({
                    content: `<h4>${restaurant.name}</h4>
                              <p>Cuisine: ${restaurant.cuisine_type}</p>
                              <p>Rating: ${restaurant.rating}</p>`
                });

                marker.addListener('click', function() {
                    infoWindow.open(map, marker);
                });
            });
        }
    </script>

</head>
<body>
    <!-- templates/restaurants/index.html -->
    <div id="map" style="height: 500px; width: 100%;"></div>

    <h1>Search for Restaurants</h1>
    <form method="GET">
        {{ form.as_p }}
        <button type="submit">Search</button>
    </form>

    <h2>Results:</h2>
    <ul>
    {% for restaurant in restaurants %}
        <li>{{ restaurant.name }} - {{ restaurant.cuisine_type }} - {{ restaurant.location }} - Rating: {{ restaurant.rating }} - Distance: {{ restaurant.distance }} km</li>
    {% empty %}
        <li>No restaurants found.</li>
    {% endfor %}
    </ul>
</body>
</html>
